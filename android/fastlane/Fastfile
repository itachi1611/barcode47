default_platform(:android)

platform :android do
  desc "Build and deploy prod app to Firebase App Distribution"

  # HOW TO USE THIS LANE:
  #
  # 1. Open your terminal and navigate to the `android` directory:
  #    cd android
  #
  # 2. Run the lane:
  #    fastlane prod
  #
  # 3. To provide custom release notes:
  #    fastlane prod note:"Your custom notes here"
  #
  # 4. To specify different tester groups:
  #    fastlane prod groups:"Group1,Group2"

  lane :prod do |options|
    # Clean and build the Flutter app
    sh("flutter", "clean")
    sh("flutter", "pub", "get")
    sh("flutter", "build", "apk", "--flavor", "prod", "--release")

    # Upload to Firebase App Distribution
    firebase_app_distribution(
      app: "1:560867969316:android:a83bcadecbb3779f9ccbb1",
      apk_path: "../build/app/outputs/flutter-apk/app-prod-release.apk",
      release_notes: options[:note] || "Production build",
      groups: options[:groups] || "Internal"
    )
  end
end
